# Product & Engineering Requirements Document (PRD) v19.0 FINAL

**Project:** Namma Ooru News - Tamil Hyperlocal AI Newsletter  
**Architecture:** Fully Ephemeral, Ultra-Low-Cost, 100% Automated Stack  
**Target:** MVP Launch (5 Districts) â†’ Full Tamil Nadu Coverage (38 Districts)  
**Philosophy:** Start Simple, Scale Automatically, Hyperlocal Monetization

**ğŸš¨ CRITICAL PRE-LAUNCH REQUIREMENT:** Fix PTR record before sending ANY emails (see Section 6.1)

---

## Executive Summary

This PRD defines a **production-grade, cost-optimized, fully automated newsletter infrastructure** that starts at **â‚¬1.40/month (â‚¹126/month)** for 5 districts and scales to **â‚¬6.71/month (â‚¹605/month)** for all 38 Tamil Nadu districts â€” achieving **99%+ net margins** through hyperlocal advertising with **zero daily manual intervention**[1].

### Key Innovation Pillars

\begin{enumerate}
\item \textbf{100\% Automated Scaling}: IPs auto-purchase when volume hits 2,000 sends/day, districts auto-rebalance across IPs
\item \textbf{Progressive IP Scaling}: Start with 1 IP, system automatically adds more based on volume triggers
\item \textbf{Ephemeral Compute}: CX33 runs 3 hours/day (05:00â€“08:00 AM IST), auto-deletes daily
\item \textbf{District-Level Ad Targeting}: Each district gets separate campaigns with district-specific ads
\item \textbf{Zero Vendor Lock-In}: Open-source stack (Listmonk, n8n, PostgreSQL, Postfix) on Hetzner + Cloudflare free tier
\item \textbf{Self-Healing Infrastructure}: Automated error recovery, backup validation, force-delete failsafes
\end{enumerate}

### Revenue Model

**At 2,500 subscribers (500/district Ã— 5 districts):**
- 2 ads per newsletter (mid-banner + footer)
- â‚¹3,000â€“â‚¹5,000 per ad per district/month
- Monthly revenue: â‚¹30,000â€“â‚¹50,000
- Infrastructure cost: â‚¹126/month
- Net margin: 99.6%+

**At full scale (38 districts, 57,000 subscribers):**
- Monthly revenue: â‚¹3,00,000â€“â‚¹5,00,000
- Infrastructure cost: â‚¹605/month
- Net margin: 99.8%+

### Your Daily Time Investment

**During operation: ~5 minutes/day**
- Read Telegram alerts (2 min)
- Check ad performance dashboard (3 min)

**Sales work: ~30 minutes/month**
- Onboard new advertisers (WhatsApp/calls)
- Review and approve ad creative

**Everything else: 100% automated**

---

## 1. System Architecture Overview

### 1.1 Infrastructure Topology

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            CLOUDFLARE FREE TIER (â‚¬0/month)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ DNS (SPF/DKIM/DMARC)                                      â”‚
â”‚ â€¢ R2 Storage (10GB free: DB backups + CDN images)           â”‚
â”‚ â€¢ Email Routing (bounces@/abuse@/dmarc@ forwarding)        â”‚
â”‚ â€¢ Workers Cron (04:55 AM daily spawn trigger)               â”‚
â”‚ â€¢ D1 Database (click_links + click_events - permanent       â”‚
â”‚   24/7 click tracking store)                                â”‚
â”‚ â€¢ Click Tracking Worker (click.nammaoorunews.com - 24/7)    â”‚
â”‚ â€¢ Auto-IP Purchase Worker (triggers on volume threshold)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          HETZNER EPHEMERAL (â‚¬1.40/month starting)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ CX33 Server (3hrs/day: 05:00â€“08:00 AM IST)                 â”‚
â”‚   â”œâ”€ n8n (pipeline orchestration + ad injection)            â”‚
â”‚   â”‚   â”œâ”€ Volume Monitor Workflow (checks daily sends)       â”‚
â”‚   â”‚   â”œâ”€ Auto-IP Purchase Workflow (Hetzner API)            â”‚
â”‚   â”‚   â”œâ”€ District Load Balancer (assigns IPs)               â”‚
â”‚   â”‚   â””â”€ Postfix Config Generator (dynamic routing)         â”‚
â”‚   â”œâ”€ PostgreSQL (subscribers + articles + ads)              â”‚
â”‚   â”œâ”€ Listmonk (campaign management + click tracking)        â”‚
â”‚   â”œâ”€ Postfix (SMTP delivery with dynamic IP routing)        â”‚
â”‚   â”œâ”€ OpenDKIM (email authentication)                        â”‚
â”‚   â””â”€ Scrapling (AI rewriting microservice)                  â”‚
â”‚                                                              â”‚
â”‚ Primary IPs: Auto-scaled based on volume                    â”‚
â”‚   Day 1: 95.217.13.142 (handles all districts)             â”‚
â”‚   Auto-trigger at 2,000 sends/day: Buys IP2                â”‚
â”‚   Auto-trigger at 4,000 sends/day: Buys IP3                â”‚
â”‚   (Formula: ceil(daily_sends / 2000) = IPs needed)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

### 1.2 Complete Day 1 Cost Breakdown

\begin{table}[h]
\centering
\begin{tabular}{|l|l|l|l|l|l|}
\hline
\textbf{Component} & \textbf{Service} & \textbf{Unit Cost} & \textbf{Quantity} & \textbf{Monthly} & \textbf{Annual} \\
\hline
Compute & Hetzner CX33 & â‚¬0.010/hour & 90 hrs/month & â‚¬0.90 & â‚¬10.80 \\
Static IP & Hetzner Primary IPv4 & \$0.60/month & 1 IP & \$0.60 & \$7.20 \\
Storage & Cloudflare R2 & â‚¬0.00 & 10GB & â‚¬0.00 & â‚¬0.00 \\
CDN & Cloudflare R2 & â‚¬0.00 & Unlimited & â‚¬0.00 & â‚¬0.00 \\
Email Routing & Cloudflare & â‚¬0.00 & Unlimited & â‚¬0.00 & â‚¬0.00 \\
Orchestration & Cloudflare Workers & â‚¬0.00 & 100k req/day & â‚¬0.00 & â‚¬0.00 \\
DNS & Cloudflare DNS & â‚¬0.00 & Unlimited & â‚¬0.00 & â‚¬0.00 \\
\hline
\textbf{TOTAL} & & & & \textbf{â‚¹135} & \textbf{â‚¹1,620} \\
\hline
\end{tabular}
\caption{Day 1 infrastructure costs (domain not included; â‚¬0.90 = â‚¹81, \$0.60 = â‚¹54)}
\end{table}

**Domain cost not included** (typically â‚¹800â€“â‚¹1,200/year for .com)

### 1.3 Hardware Specifications

**Hetzner CX33 (Ephemeral Instance):**

\begin{itemize}
\item \textbf{vCPU:} 4 cores (AMD EPYC, shared)
\item \textbf{RAM:} 8 GB DDR4
\item \textbf{Storage:} 80 GB NVMe SSD (ephemeral, wiped daily)
\item \textbf{Network:} 20 TB traffic/month included
\item \textbf{Location:} Helsinki (hel1) datacenter
\item \textbf{Uptime:} 3 hours/day (05:00â€“08:00 AM IST)
\item \textbf{Lifecycle:} Created 04:55 AM â†’ Self-deleted 08:00 AM
\item \textbf{Hourly Cost:} â‚¬0.010/hour (capped at â‚¬5.99/month if left on 24/7)
\end{itemize}

**Network Configuration:**

\begin{itemize}
\item Primary IPv4: 95.217.13.142 (static, â‚¬0.50/month, already owned)
\item Auto-scaled IPs: System automatically purchases more as volume grows
\item Primary IPv6: 2a01:4f9:c013:813f::/64 (free, not used for email - Gmail blocks)
\item Hetzner private network (10.0.0.0/16) for internal container communication
\item Firewall: Outbound SMTP (25/TCP), HTTPS (443/TCP), DNS (53/UDP) allowed; inbound SSH (22/TCP) from specific IPs only
\end{itemize}

---

## 2. Automatic IP Scaling System (100% Automated)

### 2.1 The Core Scaling Logic

**Simple Formula:**

Total daily sends across ALL districts > 2,000 â†’ Buy new IP automatically
IPs needed = ceil(total_daily_sends / 2000)

**Why 2,000 sends/day per IP?**

\begin{itemize}
\item Gmail's safe warmup threshold: 1,500/day[2]
\item Buffer for engagement spikes: +500 cushion
\item Maintains good sender reputation
\item Well below Gmail's 5,000/day bulk limit
\end{itemize}

**CRITICAL: IP Warmup Reality Check**

The 2,000/day limit is your **steady-state target after 3-4 weeks of warmup**. You CANNOT start at 2,000 on Day 1 â€” this instantly triggers spam filters[8][9].

**Realistic warmup schedule per new IP:**

\begin{table}[h]
\centering
\begin{tabular}{|l|l|l|}
\hline
\textbf{Phase} & \textbf{Days} & \textbf{Max emails/day} \\
\hline
1 & 1â€“2 & 100â€“200 \\
2 & 3â€“4 & 300â€“400 \\
3 & 5â€“7 & 600â€“800 \\
4 & 8â€“10 & 1,000â€“1,200 \\
5 & 11â€“14 & 1,500â€“2,000 \\
6 & Weeks 3â€“4 & 2,000â€“3,000 \\
7 & Month 2+ & 3,000â€“5,000 \\
\hline
\end{tabular}
\caption{Conservative warmup schedule (assumes good engagement, low bounces)[8][9]}
\end{table}

**What this means for your launch:**

\begin{itemize}
\item \textbf{Day 1:} Start with 1 district, 100 subscribers maximum
\item \textbf{Week 1:} Gradually add more subscribers from same district
\item \textbf{Week 2:} Add 2nd district once IP1 stabilizes at 800â€“1,000/day
\item \textbf{Week 3â€“4:} Scale to all 5 MVP districts as IP1 reaches 2,000/day capacity
\end{itemize}

**When adding IP2:**

\begin{itemize}
\item IP1 must be stable at 1,500â€“2,000/day with good metrics
\item Start IP2 at 100â€“200/day (not immediately at 1,000+)
\item Gradually shift 100â€“200 sends/day from IP1 to IP2 every 2â€“3 days[10]
\item Keep IP1 carrying bulk until IP2 proves itself over 2 weeks
\end{itemize}

**Why gradual matters:** ISPs track sudden volume spikes. Going from 0 â†’ 2,000 overnight = spam behavior pattern. Warming 0 â†’ 100 â†’ 300 â†’ 800 â†’ 2,000 over a month = legitimate sender pattern[9][10].

### 2.2 Automatic Scaling Timeline

\begin{table}[h]
\centering
\begin{tabular}{|l|l|l|l|l|}
\hline
\textbf{Total Daily Sends} & \textbf{IPs Active} & \textbf{Trigger} & \textbf{Monthly Cost} & \textbf{What Happens} \\
\hline
0â€“2,000 & 1 & â€” & â‚¹135 & All districts share IP1 \\
2,001â€“4,000 & 2 & âœ… Auto at 2,001 & â‚¹189 & System buys IP2, rebalances \\
4,001â€“6,000 & 3 & âœ… Auto at 4,001 & â‚¹243 & System buys IP3, rebalances \\
6,001â€“8,000 & 4 & âœ… Auto at 6,001 & â‚¹297 & System buys IP4, rebalances \\
8,001â€“10,000 & 5 & âœ… Auto at 8,001 & â‚¹351 & System buys IP5, rebalances \\
20,001â€“22,000 & 11 & âœ… Auto & â‚¹675 & CX33â†’CX43 upgrade triggered \\
100,001+ & 51 & âœ… Auto & â‚¹2,835 & Multi-server architecture \\
\hline
\end{tabular}
\caption{Automatic IP scaling thresholds (updated costs with \$0.60/IP)}
\end{table}

**Upgrade to CX43 triggers at 20 districts** (300+ articles need more CPU):
- CX33: â‚¬0.90/month â†’ CX43: â‚¬1.62/month (+â‚¬0.72)
- Total at 20 districts: â‚¬1.62 (compute) + â‚¬3.50 (7 IPs) = â‚¬5.12/month

### 2.3 Complete Automation Flow (Zero Manual Intervention)

Every morning at 07:48 AM (after all campaigns complete):

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  n8n: Volume Monitor Workflow (runs automatically)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  1. Query PostgreSQL:                                       â”‚
â”‚     SELECT SUM(sent_count) FROM campaign_metrics           â”‚
â”‚     WHERE created_at::date = CURRENT_DATE                   â”‚
â”‚                                                             â”‚
â”‚  2. Calculate: emails_per_ip = total_sends / current_ips   â”‚
â”‚                                                             â”‚
â”‚  3. Decision Logic:                                         â”‚
â”‚     IF emails_per_ip > 2000 AND current_ips < 10:          â”‚
â”‚       â†’ TRIGGER IP PURCHASE WORKFLOW                        â”‚
â”‚     ELSE:                                                   â”‚
â”‚       â†’ Log "Healthy: X emails/IP/day" and exit            â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“ (if triggered)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  n8n: Auto-IP Purchase Workflow (30 seconds)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  1. Call Hetzner API: Create Primary IPv4                  â”‚
â”‚     POST /v1/primary_ips                                    â”‚
â”‚     { type: 'ipv4', datacenter: 'hel1-dc2',                â”‚
â”‚       name: 'namma-ip-2', auto_delete: false }             â”‚
â”‚     Response: { ip: '95.217.13.200', id: 12345 }          â”‚
â”‚                                                             â”‚
â”‚  2. Set PTR Record (reverse DNS):                           â”‚
â”‚     POST /v1/primary_ips/12345/actions/change_dns_ptr      â”‚
â”‚     { dns_ptr: 'mail2.nammaoorunews.com', ip: '...' }     â”‚
â”‚                                                             â”‚
â”‚  3. Update Cloudflare SPF Record:                           â”‚
â”‚     Current: "v=spf1 ip4:95.217.13.142 ~all"              â”‚
â”‚     New: "v=spf1 ip4:95.217.13.142 ip4:95.217.13.200 ~all"â”‚
â”‚                                                             â”‚
â”‚  4. Add Cloudflare DKIM Record:                             â”‚
â”‚     mail2._domainkey "v=DKIM1; k=rsa; p=..." (pre-gen)    â”‚
â”‚                                                             â”‚
â”‚  5. Update n8n Variable: ACTIVE_IPS                         â”‚
â”‚     ['95.217.13.142', '95.217.13.200']                     â”‚
â”‚                                                             â”‚
â”‚  6. Update Cloudflare Worker Secret:                        â”‚
â”‚     PRIMARY_IP_2_ID = 12345                                 â”‚
â”‚                                                             â”‚
â”‚  7. Send Telegram Alert:                                    â”‚
â”‚     "ğŸ†• New IP Auto-Purchased! IP: 95.217.13.200           â”‚
â”‚      Reason: 2,047 total sends > 2,000 threshold           â”‚
â”‚      New monthly cost: â‚¬1.90/month (+â‚¹45)"                 â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  n8n: District Load Balancer (automatic rebalancing)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  1. Get all active IPs from ACTIVE_IPS variable            â”‚
â”‚                                                             â”‚
â”‚  2. Query subscriber counts per district:                   â”‚
â”‚     SELECT district, COUNT(*) FROM subscribers             â”‚
â”‚     GROUP BY district ORDER BY count DESC                   â”‚
â”‚                                                             â”‚
â”‚  3. Greedy bin-packing algorithm:                           â”‚
â”‚     - Start with empty load per IP                          â”‚
â”‚     - For each district (heaviest first):                   â”‚
â”‚       * Assign to IP with lowest current load               â”‚
â”‚       * Add district's subscriber count to that IP's load   â”‚
â”‚                                                             â”‚
â”‚  4. Update DISTRICT_IP_MAP variable:                        â”‚
â”‚     { 'chennai': '95.217.13.142',    // 800 subs           â”‚
â”‚       'coimbatore': '95.217.13.200', // 600 subs           â”‚
â”‚       'madurai': '95.217.13.142',    // 400 subs           â”‚
â”‚       'trichy': '95.217.13.200',     // 300 subs           â”‚
â”‚       'virudhunagar': '95.217.13.200' // 200 subs }        â”‚
â”‚     IP1 load: 1,200 | IP2 load: 1,100 (balanced!)         â”‚
â”‚                                                             â”‚
â”‚  5. This mapping used by Postfix config generator tomorrow â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

**Your involvement in this entire process: 0 minutes**

### 2.4 Additional Critical Limitations

#### 2.4.1 Recycled IP Blacklist Risk (Check BEFORE Sending)

**ğŸš¨ HIGH PROBABILITY ISSUE:** Hetzner IPs are recycled from previous customers. Your IP `95.217.13.142` may already be on spam blacklists before you send a single email[11][12].

**Check your IP NOW:**

\begin{enumerate}
\item Visit https://mxtoolbox.com/blacklists.aspx
\item Enter: 95.217.13.142
\item Check against 100+ blacklists (free, takes 30 seconds)[13]
\end{enumerate}

**Common Hetzner IP blacklists:**

\begin{itemize}
\item Spamhaus (most critical â€” Gmail uses this)
\item Barracuda
\item SORBS
\item SpamCop
\item Microsoft SNDS (separate from main blacklists)
\end{itemize}

**If blacklisted:**

\begin{enumerate}
\item \textbf{DO NOT send any emails yet}
\item Request delisting (free for most blacklists, 24â€“48 hour turnaround)
\item For Spamhaus: https://check.spamhaus.org/
\item For Microsoft: https://sender.office.com/ (if blocked)[14]
\item Wait for confirmation before proceeding with PTR fix and testing
\end{enumerate}

**Cost of ignoring this:** Instant hard bounces + domain reputation damage on Day 1.

#### 2.4.2 Microsoft/Outlook Blacklist (Separate Issue)

Hetzner Helsinki IP ranges are frequently pre-listed on Microsoft's internal blacklist[14]. Even with perfect PTR + SPF + DKIM + DMARC, Outlook/Hotmail users may get hard rejections.

**Solution:** Submit Junk Mail Reporting Program (JMRP) delisting request to Microsoft after fixing PTR and warming up IP for 1â€“2 weeks[14].

**Impact:** ~20â€“30% of Indian email users use Outlook/Hotmail. Budget for this deliverability gap in early months.

#### 2.4.3 Why IPv4 Is Non-Negotiable (IPv6 Won't Work)

**The Gmail IPv6 Block Problem:**

IPv6 sender without reputation â†’ Gmail returns:
"550-5.7.1 Our system has detected that this message is likely unsolicited mail. This message has been blocked."[3]

This is a HARD REJECTION (not spam folder - completely bounced)

**Why this happens:**

\begin{itemize}
\item IPv6 address space: 340 undecillion addresses
\item Impossible to track reputation per address
\item Gmail's default: unknown IPv6 sender = spam = blocked[3]
\item Even with perfect SPF/DKIM/DMARC setup
\end{itemize}

**Real-world evidence:**

\begin{itemize}
\item Self-hosted email experts report 99\% hard-block rate for new IPv6 senders
\item Gmail's IPv6 filtering engine doesn't have established reputation systems
\item Takes 6+ months of IPv4 reputation building before IPv6 becomes viable[3]
\end{itemize}

**Cost-benefit analysis:**

IPv4 cost per IP:     $0.60/month = â‚¹54/month
Revenue at risk:      â‚¹5,000/month per district (if Gmail blocks)
Breaking even:        â‚¹54 protects â‚¹5,000+ revenue
ROI of IPv4:          9,160%+

Saving â‚¹54 to lose â‚¹5,000 = worst business decision possible

**Verdict:** IPv4 is not a cost â€” it's revenue insurance. The â‚¹54/IP/month is the cheapest insurance you'll ever buy.

#### 2.4.4 Updated Cost Model ($0.60/IP vs â‚¬0.50/IP)

**Corrected monthly IP costs:**

\begin{table}[h]
\centering
\begin{tabular}{|l|l|l|}
\hline
\textbf{IPs} & \textbf{Monthly Cost (USD)} & \textbf{Monthly Cost (INR)} \\
\hline
1 & \$0.60 & â‚¹54 \\
2 & \$1.20 & â‚¹108 \\
3 & \$1.80 & â‚¹162 \\
5 & \$3.00 & â‚¹270 \\
10 & \$6.00 & â‚¹540 \\
20 & \$12.00 & â‚¹1,080 \\
30 & \$18.00 & â‚¹1,620 \\
\hline
\end{tabular}
\caption{Hetzner Primary IPv4 pricing (confirmed 2026)}
\end{table}

**Updated Day 1 total infrastructure cost:**

\begin{itemize}
\item Hetzner CX33 ephemeral: â‚¬0.90/month (â‚¹81)
\item Hetzner Primary IPv4: \$0.60/month (â‚¹54)
\item Cloudflare (all services): â‚¬0.00
\item \textbf{Total Day 1: â‚¹135/month} (vs â‚¹126 previously stated)
\end{itemize}

---

## 3. Complete Daily Operational Flow (100% Automated)

### 3.1 Timeline (Every Morning)

**04:55 AM IST** â†’ Cloudflare Worker Cron fires
- Creates CX33 via Hetzner API
- Attaches Primary IP(s) based on ACTIVE_IPS
- Injects cloud-init script
- Sends Telegram alert: "âœ… CX33 spawned"

**05:00 AM** â†’ CX33 boots, Docker services start
- PostgreSQL restores from R2 (latest.sql.gz)
- n8n imports workflows from R2
- Services healthy check completes

**05:02 AM** â†’ generate_postfix_config.sh executes
- Fetches DISTRICT_IP_MAP from n8n API
- Dynamically generates Postfix transport rules
- Postfix reloads with correct IP routing

**05:03 AM** â†’ D1 Click Sync Workflow executes
- Pulls yesterday's click events from Cloudflare D1
- Inserts into PostgreSQL ad_performance table
- Updates campaign_metrics with click counts
- Marks D1 events as synced (is_synced = 1)
- Cleans up old synced events (>30 days)

**05:05 AM** â†’ n8n webhook receives trigger
- Main pipeline begins execution

**05:05-07:00 AM** â†’ FOR EACH district IN [Chennai, Coimbatore, ...]:

1. **CONTENT COLLECTION:**
   - Google News RSS query (Tamil + district name)
   - LLM semantic deduplication
   - FOR EACH unique article:
     - Scrapling â†’ scrape text + image
     - Upload image â†’ R2 CDN
     - AI Rewrite (Round-Robin NVIDIA API)
     - JSON validation
     - INSERT INTO articles table

2. **AD INJECTION:**
   - Query ads table for active district ads
   - Fetch ads WHERE district = 'chennai' OR district = 'all'
   - Build ad HTML blocks (mid-banner, footer)
   - Track impression start

3. **LINK TOKEN GENERATION (Critical for 24/7 tracking):**
   - FOR EACH ad and article link:
     - Generate unique token (UUID)
     - INSERT INTO Cloudflare D1 click_links table
     - Replace original URL with Cloudflare Worker URL
     - Format: https://click.nammaoorunews.com/l/{token}?sid={{subscriber_id}}
   - All links now point to 24/7 Cloudflare infrastructure

4. **CAMPAIGN GENERATION:**
   - Query today's articles for district
   - Inject articles into HTML template (with tracking URLs)
   - Inject district-specific ads into template (with tracking URLs)
   - Listmonk API: Create campaign (status=draft)

**06:30 AM** â†’ n8n: Change Chennai campaign â†’ status=running
- Listmonk begins sending (via Postfix)
- Emails route to correct IP based on sender_transport
- Ad impressions logged to campaign_metrics

**06:45 AM** â†’ Coimbatore campaign starts  
**07:00 AM** â†’ Madurai campaign starts  
**07:15 AM** â†’ Trichy campaign starts  
**07:30 AM** â†’ Virudhunagar campaign starts

**07:45 AM** â†’ All campaigns complete
- n8n records metrics to campaign_metrics table
- Ad performance data extracted from Listmonk

**07:48 AM** â†’ AUTOMATIC SCALING CHECK:
- Volume Monitor Workflow executes
- IF total_sends > 2000 per IP:
  - Trigger IP Purchase Workflow
  - Purchase new Primary IP from Hetzner
  - Update DNS records in Cloudflare
  - Rebalance districts across IPs
  - Send Telegram: "New IP auto-purchased"
- ELSE:
  - Log: "Healthy: X emails/IP, no action needed"

**07:50 AM** â†’ Backup script executes:
- pg_dump listmonk â†’ /tmp/namma_db_2026-02-24.sql.gz
- Upload to R2 (with 3x retry)
- Export n8n workflows â†’ R2
- Export campaign_metrics CSV â†’ R2
- Export ad_performance CSV â†’ R2
- DELETE articles older than 30 days

**07:55 AM** â†’ Pre-delete validation:
- Verify R2 upload successful
- If failed: Abort delete, alert Telegram
- If success: Proceed to delete

**08:00 AM** â†’ Self-delete:
- Get instance ID from metadata API
- Call Hetzner DELETE /v1/servers/{id}
- Send Telegram: "âœ… Self-delete complete"

**09:00 AM** â†’ Cloudflare Worker backup delete check:
- Query Hetzner API for server existence
- If still alive: Force delete, alert warning
- If deleted: No action (self-delete worked)

### 3.2 What You Actually Do Each Day

Your morning routine:

**07:50 AM** â†’ Receive Telegram: "âœ… All campaigns sent successfully"
- (Read notification: 10 seconds)

**07:51 AM** â†’ Open phone, check alert details
- (Optional: 30 seconds)

**08:05 AM** â†’ Check Listmonk dashboard (if curious)
- (Optional: 2 minutes)

**TOTAL TIME: ~30 seconds to 3 minutes**  
**REQUIRED ACTION: None (just awareness)**

**Everything else runs itself.**

---

## 4. Database Schema & Data Management

### 4.1 PostgreSQL Tables

**Database:** listmonk (shared by Listmonk + custom tables)

**Custom Table: articles**

CREATE TABLE articles (
    id SERIAL PRIMARY KEY,
    source_url TEXT UNIQUE NOT NULL,
    publisher_name VARCHAR(100) NOT NULL,
    cdn_image_url TEXT,
    raw_title TEXT NOT NULL,
    ai_summary TEXT NOT NULL,
    ai_title TEXT NOT NULL,
    category VARCHAR(50) NOT NULL,
    location VARCHAR(50) NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    
    CONSTRAINT articles_location_check CHECK (location IN (
        'chennai', 'coimbatore', 'madurai', 'trichy', 'virudhunagar'
    ))
);

CREATE INDEX idx_articles_location_date ON articles(location, created_at DESC);
CREATE INDEX idx_articles_created_at ON articles(created_at DESC);
CREATE INDEX idx_articles_category ON articles(category);
CREATE INDEX idx_articles_source_url ON articles USING hash(source_url);

**Custom Table: ads (Hyperlocal Ad Management)**

CREATE TABLE ads (
    id SERIAL PRIMARY KEY,
    advertiser_name VARCHAR(100) NOT NULL,
    advertiser_email VARCHAR(255),
    advertiser_phone VARCHAR(20),
    
    district VARCHAR(50) NOT NULL,
    position VARCHAR(20) NOT NULL,
    
    html_content TEXT NOT NULL,
    tracking_url TEXT NOT NULL,
    image_url TEXT,
    
    start_date DATE NOT NULL,
    end_date DATE NOT NULL,
    is_active BOOLEAN DEFAULT TRUE,
    
    priority INTEGER DEFAULT 1,
    price_paid NUMERIC(10,2),
    currency VARCHAR(3) DEFAULT 'INR',
    
    impressions_total INTEGER DEFAULT 0,
    clicks_total INTEGER DEFAULT 0,
    
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    
    CONSTRAINT ads_district_check CHECK (
        district IN ('all', 'chennai', 'coimbatore', 'madurai', 
                     'trichy', 'virudhunagar')
    ),
    CONSTRAINT ads_position_check CHECK (
        position IN ('header', 'mid', 'footer', 'inline')
    )
);

CREATE INDEX idx_ads_district_active ON ads(district, is_active, start_date, end_date);
CREATE INDEX idx_ads_position ON ads(position);
CREATE INDEX idx_ads_priority ON ads(priority DESC);

**Custom Table: ad_performance (Daily Analytics)**

CREATE TABLE ad_performance (
    id SERIAL PRIMARY KEY,
    ad_id INTEGER REFERENCES ads(id) ON DELETE CASCADE,
    campaign_id INTEGER,
    district VARCHAR(50) NOT NULL,
    
    date DATE NOT NULL DEFAULT CURRENT_DATE,
    impressions INTEGER DEFAULT 0,
    clicks INTEGER DEFAULT 0,
    unique_clicks INTEGER DEFAULT 0,
    ctr NUMERIC(5,2) GENERATED ALWAYS AS (
        CASE WHEN impressions > 0 
        THEN ROUND((clicks::NUMERIC / impressions * 100), 2)
        ELSE 0 END
    ) STORED,
    
    revenue_earned NUMERIC(10,2),
    
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    
    CONSTRAINT ad_performance_unique UNIQUE (ad_id, date, district)
);

CREATE INDEX idx_ad_performance_date ON ad_performance(date DESC);
CREATE INDEX idx_ad_performance_ad_id ON ad_performance(ad_id, date DESC);
CREATE INDEX idx_ad_performance_district ON ad_performance(district, date DESC);

**Custom Table: campaign_metrics**

CREATE TABLE campaign_metrics (
    id SERIAL PRIMARY KEY,
    campaign_id INTEGER NOT NULL,
    district VARCHAR(50) NOT NULL,
    sending_ip INET NOT NULL,
    
    sent_count INTEGER DEFAULT 0,
    delivered_count INTEGER DEFAULT 0,
    bounced_count INTEGER DEFAULT 0,
    opened_count INTEGER DEFAULT 0,
    clicked_count INTEGER DEFAULT 0,
    spam_complaint_count INTEGER DEFAULT 0,
    
    send_started_at TIMESTAMP WITH TIME ZONE,
    send_completed_at TIMESTAMP WITH TIME ZONE,
    
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_campaign_metrics_district ON campaign_metrics(district, created_at DESC);
CREATE INDEX idx_campaign_metrics_campaign_id ON campaign_metrics(campaign_id);
CREATE INDEX idx_campaign_metrics_date ON campaign_metrics(created_at DESC);

**Custom Table: ip_scaling_history (Track Automatic IP Purchases)**

CREATE TABLE ip_scaling_history (
    id SERIAL PRIMARY KEY,
    ip_address INET NOT NULL,
    ip_id INTEGER NOT NULL,
    
    trigger_reason VARCHAR(255) NOT NULL,
    daily_sends_at_trigger INTEGER NOT NULL,
    ips_before INTEGER NOT NULL,
    ips_after INTEGER NOT NULL,
    
    monthly_cost_before NUMERIC(10,2),
    monthly_cost_after NUMERIC(10,2),
    
    ptr_record VARCHAR(255),
    spf_record_updated TEXT,
    
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_ip_scaling_date ON ip_scaling_history(created_at DESC);

**Listmonk Tables (Auto-Created):**

\begin{itemize}
\item subscribers â€” User email, name, status (confirmed/unsubscribed/bounced)
\item lists â€” District lists (Chennai, Coimbatore, etc.)
\item campaigns â€” Daily email campaigns
\item campaign\_views â€” Open tracking
\item link\_clicks â€” Click tracking (used for ad analytics)
\end{itemize}

### 4.2 Sample Ad Data (Seeding)

-- Example ads for Virudhunagar
INSERT INTO ads (
    advertiser_name, district, position, html_content, 
    tracking_url, start_date, end_date, priority, price_paid
) VALUES 
(
    'VND Silk Sarees',
    'virudhunagar',
    'mid',
    '<table width="100%" style="background:#fff7ed;border:2px solid #f97316;border-radius:8px;padding:16px;margin:20px 0;">
      <tr><td>
        <p style="font-size:11px;color:#f97316;margin:0;text-transform:uppercase;">à®µà®¿à®³à®®à¯à®ªà®°à®®à¯ (Sponsored)</p>
        <p style="font-size:16px;font-weight:bold;color:#1a1a1a;margin:8px 0;">à®µà®¿à®°à¯à®¤à¯à®¨à®•à®°à¯ à®šà®¿à®±à®¨à¯à®¤ à®ªà®Ÿà¯à®Ÿà¯ à®ªà¯à®Ÿà®µà¯ˆà®•à®³à¯</p>
        <p style="font-size:14px;color:#444;">VND Silk Sarees - à®¤à¯€à®ªà®¾à®µà®³à®¿ à®šà®¿à®±à®ªà¯à®ªà¯ 40% à®¤à®³à¯à®³à¯à®ªà®Ÿà®¿</p>
        <a href="https://click.nammaoorunews.com/ad/vnd-silk-123" style="background:#f97316;color:#fff;padding:8px 16px;border-radius:4px;text-decoration:none;font-size:14px;">à®‡à®ªà¯à®ªà¯‹à®¤à¯‡ à®ªà®¾à®°à¯à®µà¯ˆà®¯à®¿à®Ÿà¯à®™à¯à®•à®³à¯ â†’</a>
      </td></tr>
    </table>',
    'https://vndsilksarees.com/diwali-sale',
    '2026-03-01',
    '2026-03-31',
    10,
    5000.00
);

---

## 5. Hyperlocal Ad System Architecture

### 5.1 District-Level Ad Targeting Flow

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  n8n: Campaign Generation (runs per district)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  district = 'virudhunagar'                                â”‚
â”‚       â†“                                                   â”‚
â”‚  Query ads table:                                         â”‚
â”‚    WHERE (district = 'virudhunagar' OR district = 'all') â”‚
â”‚      AND is_active = TRUE                                 â”‚
â”‚      AND start_date <= CURRENT_DATE                       â”‚
â”‚      AND end_date >= CURRENT_DATE                         â”‚
â”‚    ORDER BY district DESC, priority DESC                  â”‚
â”‚       â†“                                                   â”‚
â”‚  Results:                                                 â”‚
â”‚    [1] VND Silk Sarees (district='virudhunagar', pri=10) â”‚
â”‚    [2] Jio TN Offer (district='all', pri=5)              â”‚
â”‚       â†“                                                   â”‚
â”‚  Inject into HTML template:                               â”‚
â”‚    {{MID_AD}} = VND Silk Sarees HTML                      â”‚
â”‚    {{FOOTER_AD}} = Jio TN Offer HTML                      â”‚
â”‚       â†“                                                   â”‚
â”‚  Generate final HTML â†’ Listmonk campaign                  â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

### 5.2 Ad Click Tracking Architecture (24/7 Cloudflare System)

**CRITICAL DESIGN:** Click tracking MUST work 24/7, even after VM deletion at 08:00 AM. Users click links throughout the day, not just in the morning.

**The Problem Without This Fix:**

\begin{itemize}
\item Email sent at 06:30 AM âœ…
\item VM self-deletes at 08:00 AM âœ…
\item User opens email at 11:00 AM âœ…
\item User clicks ad link at 11:01 AM âŒ
\item click.nammaoorunews.com/l/abc123 â†’ points to dead Listmonk âŒ
\item Result: 404 Error, lost click, angry advertiser âŒ
\end{itemize}

**The Solution: Cloudflare Worker + D1 as Permanent Click Handler**

\begin{table}[h]
\centering
\begin{tabular}{|l|l|}
\hline
\textbf{Component} & \textbf{Uptime} \\
\hline
VM (Listmonk inside) & 3 hours/day (05:00-08:00 AM) \\
Cloudflare Worker & 24/7/365 (free tier, always available) \\
Cloudflare D1 & 24/7/365 (permanent database) \\
\hline
\end{tabular}
\end{table}

#### 5.2.1 Cloudflare D1 Database Schema (Permanent Storage)

**Lives in Cloudflare D1 (NOT in VM PostgreSQL) - persists 24/7:**

-- Table 1: Link Token Mapping
CREATE TABLE click_links (
    token TEXT PRIMARY KEY,
    campaign_id INTEGER NOT NULL,
    ad_id INTEGER,
    district TEXT NOT NULL,
    destination_url TEXT NOT NULL,
    created_at TEXT NOT NULL
);

CREATE INDEX idx_click_links_token ON click_links(token);
CREATE INDEX idx_click_links_campaign ON click_links(campaign_id);

-- Table 2: Click Event Log
CREATE TABLE click_events (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    token TEXT NOT NULL,
    subscriber_id TEXT,
    clicked_at TEXT NOT NULL,
    user_agent TEXT,
    ip_address TEXT,
    is_synced INTEGER DEFAULT 0
);

CREATE INDEX idx_click_events_token ON click_events(token);
CREATE INDEX idx_click_events_synced ON click_events(is_synced, clicked_at);

**D1 Free Tier Limits:**

\begin{itemize}
\item Storage: 5GB (holds millions of clicks)
\item Reads: 5M rows/day (handles 100k+ clicks/day easily)
\item Writes: 100k rows/day (each click = 1 write)
\item Cost if exceeded: \$0.001 per 1k writes (â‚¹0.09 per 1k clicks)
\end{itemize}

#### 5.2.2 Cloudflare Worker Implementation (24/7 Click Handler)

**Deployed to:** click.nammaoorunews.com  
**Runs:** 24/7/365 on Cloudflare edge network (free tier: 100k requests/day)

// click-tracker-worker.js
// This worker NEVER goes offline (unlike VM which deletes at 08:00 AM)

export default {
  async fetch(request, env) {
    const url = new URL(request.url);
    
    const pathMatch = url.pathname.match(/^\/l\/([^/]+)$/);
    if (!pathMatch) {
      return new Response('Invalid link format', { status: 404 });
    }
    
    const token = pathMatch[1];
    
    const link = await env.DB.prepare(`
      SELECT destination_url, campaign_id, ad_id, district 
      FROM click_links 
      WHERE token = ?
    `).bind(token).first();

    if (!link) {
      return new Response('Link expired or invalid', { status: 410 });
    }

    const subscriberId = url.searchParams.get('sid') || null;
    
    await env.DB.prepare(`
      INSERT INTO click_events (
        token, subscriber_id, clicked_at, user_agent, ip_address
      ) VALUES (?, ?, ?, ?, ?)
    `).bind(
      token,
      subscriberId,
      new Date().toISOString(),
      request.headers.get('user-agent') || '',
      request.headers.get('cf-connecting-ip') || ''
    ).run();

    return Response.redirect(link.destination_url, 302);
  }
}

---

## 6. Email Infrastructure & Deliverability

### 6.1 Critical PTR Record Configuration (MUST FIX BEFORE SENDING)

**ğŸš¨ STOP: DO NOT SEND ANY EMAILS UNTIL THIS IS FIXED**

Your current Hetzner Primary IP has a **show-stopping deliverability issue**[4]:

\begin{table}[h]
\centering
\begin{tabular}{|l|l|l|}
\hline
\textbf{Component} & \textbf{Current Status} & \textbf{Impact} \\
\hline
IP Address & 95.217.13.142 & âœ… Correct \\
PTR Record & static.142.13.217.95.clients.your-server.de & âŒ BREAKS EVERYTHING \\
Required PTR & mail.nammaoorunews.com & Must fix immediately \\
\hline
\end{tabular}
\end{table}

**Why Your Current PTR Guarantees 100% Spam Delivery:**

\begin{enumerate}
\item \textbf{Generic Hetzner Hostname:} clients.your-server.de is a shared hosting indicator[4]
\item \textbf{Gmail's Instant Block:} Generic PTRs = known spam source = hard rejection (not spam folder - complete bounce)[5]
\item \textbf{Yahoo/Outlook/Hotmail:} Same aggressive filtering - auto-reject generic PTRs[5]
\item \textbf{Perfect SPF/DKIM/DMARC Won't Help:} Email authentication only works AFTER PTR passes[6]
\end{enumerate}

**Real-World Impact:**

Day 1 Test Email:
  â†’ Gmail: "550-5.7.1 likely unsolicited mail" (rejected)
  â†’ Yahoo: Silently dropped (never reaches inbox)
  â†’ Outlook: "Rejected due to sender reputation"

Week 1:
  â†’ Domain nammaoorunews.com flagged as spam source
  â†’ Reputation score: -10 (permanent damage)

Month 1:
  â†’ Domain blacklisted across major ESPs
  â†’ Requires 6+ months to rebuild reputation

**The 30-Second Fix (Do This NOW):**

**Step 1:** Go to Hetzner Cloud Console â†’ Primary IPs tab (where your screenshot is from)[7]

**Step 2:** Click the `Â·Â·Â·` (three dots) menu next to `95.217.13.142`[7]

**Step 3:** Select "Edit Reverse DNS"[7]

**Step 4:** In the form that appears:

\begin{itemize}
\item \textbf{IP Address:} 95.217.13.142 (pre-filled)
\item \textbf{Reverse DNS:} mail.nammaoorunews.com (type this exactly)
\item Click "Save"
\end{itemize}

**Step 5:** Wait 5 minutes for DNS propagation[6]

**Step 6:** Verify the fix worked:

# Run this command (should return mail.nammaoorunews.com)
dig -x 95.217.13.142 +short

# Expected output:
mail.nammaoorunews.com.

# If you still see clients.your-server.de, wait another 5 minutes

**Visual Verification in Hetzner Console:**

After the fix, your Primary IPs table should show:

\begin{table}[h]
\centering
\begin{tabular}{|l|l|}
\hline
\textbf{Column} & \textbf{Value After Fix} \\
\hline
IP address & 95.217.13.142 \\
Reverse DNS & mail.nammaoorunews.com \\
Server & Unassigned (this is correct for ephemeral) \\
Location & Helsinki \\
\hline
\end{tabular}
\end{table}

**Why "Unassigned" Server is Correct:**

Your screenshot shows both IPs as "Unassigned" - this is **expected and correct** for ephemeral architecture:

\begin{itemize}
\item Primary IPs are "floating" resources
\item They get \textbf{attached dynamically} during CX33 spawn (05:00 AM daily)
\item They \textbf{detach automatically} when CX33 self-deletes (08:00 AM)
\item Billing continues at â‚¬0.50/month even when unassigned
\item This is cheaper than keeping server running 24/7
\end{itemize}

**Cost-Benefit Analysis:**

Cost to fix PTR:           â‚¬0 (free, takes 30 seconds)
Revenue protected:         â‚¹30,000+/month (prevents spam delivery)
Time to fix:              30 seconds
Time to recover if broken: 6+ months

This is the highest-ROI action in the entire project.

**Checklist Before Sending First Email:**

\begin{itemize}
\item[$\square$] PTR record changed to mail.nammaoorunews.com in Hetzner
\item[$\square$] Waited 5 minutes for propagation
\item[$\square$] Verified with dig -x 95.217.13.142 command
\item[$\square$] Hetzner console shows correct Reverse DNS
\item[$\square$] Only then proceed to test email sending
\end{itemize}

**What Happens If You Skip This:**

\begin{itemize}
\item First test email to Gmail: \textbf{Rejected} (hard bounce)
\item Domain reputation: \textbf{Destroyed} on Day 1
\item Recovery time: \textbf{6+ months} of consistent good sending
\item Business impact: \textbf{Cannot launch} until reputation rebuilt
\end{itemize}

**This single 30-second action is the difference between:**

\begin{itemize}
\item âœ… 98\% inbox delivery rate
\item âŒ 0\% inbox delivery rate
\end{itemize}

**Do not skip this. Fix it now before proceeding with any other setup.**

### 6.2 DNS Configuration (Cloudflare) - Auto-Updated

**SPF Record (Automatically Updated by n8n):**

# Day 1 (manual setup - AFTER fixing PTR)
TXT @ "v=spf1 ip4:95.217.13.142 ~all"

# After auto-scaling triggers (n8n updates automatically)
TXT @ "v=spf1 ip4:95.217.13.142 ip4:95.217.13.200 ip4:95.217.13.201 ~all"

**DKIM Records (Pre-Generated, Auto-Added):**

# Day 1
TXT mail._domainkey "v=DKIM1; k=rsa; p=MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC..."

# After auto-scaling (n8n adds automatically)
TXT mail2._domainkey "v=DKIM1; k=rsa; p=MIGfMA0GCSq..."
TXT mail3._domainkey "v=DKIM1; k=rsa; p=MIGfMA0GCSq..."

**DMARC Record (Progressive Strictness):**

# Week 1-2: Monitor only
TXT _dmarc "v=DMARC1; p=none; rua=mailto:dmarc@nammaoorunews.com; pct=100; adkim=r; aspf=r"

# Week 3-4: Quarantine failures
TXT _dmarc "v=DMARC1; p=quarantine; rua=mailto:dmarc@nammaoorunews.com; pct=100; adkim=s; aspf=s"

# Week 5+: Reject unauthenticated
TXT _dmarc "v=DMARC1; p=reject; rua=mailto:dmarc@nammaoorunews.com; pct=100; adkim=s; aspf=s"

**PTR Records (MUST BE SET MANUALLY FIRST, THEN AUTO-SET BY n8n):**

# Day 1: Set manually in Hetzner Cloud Console (CRITICAL)
95.217.13.142 â†’ mail.nammaoorunews.com

# Future IPs: Auto-set by n8n via Hetzner API
95.217.13.200 â†’ mail2.nammaoorunews.com  (Auto-added by system)
95.217.13.201 â†’ mail3.nammaoorunews.com  (Auto-added by system)

---

## 7. Monetization Strategy & Advertiser Onboarding

### 7.1 Pricing Tiers (Per District)

\begin{table}[h]
\centering
\begin{tabular}{|l|l|l|l|l|}
\hline
\textbf{Tier} & \textbf{Placement} & \textbf{Rate/District} & \textbf{State-Wide} & \textbf{Avg CTR} \\
\hline
Premium & Header banner & â‚¹8,000â€“â‚¹15,000 & â‚¹50,000â€“â‚¹1,00,000 & 12â€“18\% \\
Standard & Mid-banner & â‚¹3,000â€“â‚¹8,000 & â‚¹25,000â€“â‚¹50,000 & 15â€“25\% \\
Basic & Footer & â‚¹1,000â€“â‚¹3,000 & â‚¹10,000â€“â‚¹20,000 & 5â€“10\% \\
Inline & Between articles & â‚¹2,000â€“â‚¹5,000 & â‚¹15,000â€“â‚¹30,000 & 10â€“15\% \\
\hline
\end{tabular}
\caption{Ad pricing tiers per month}
\end{table}

**Package Deals:**

\begin{itemize}
\item 2 positions (mid + footer): 20\% discount
\item 3 months commitment: 15\% discount
\item 6 months commitment: 25\% discount
\end{itemize}

### 7.2 Revenue Projections

**Phase 1: MVP (5 Districts, 2,500 Subscribers)**

Per District:
  - 500 subscribers
  - 2 ads (mid + footer)
  - â‚¹4,000 + â‚¹1,500 = â‚¹5,500/district/month

Total Revenue: â‚¹5,500 Ã— 5 = â‚¹27,500/month
Infrastructure Cost: â‚¹126/month
Net Profit: â‚¹27,374/month (99.5% margin)

**Phase 2: Growth (10 Districts, 10,000 Subscribers)**

Total Revenue: â‚¹5,500 Ã— 10 = â‚¹55,000/month
Infrastructure Cost: â‚¹216/month (2 IPs auto-purchased)
Net Profit: â‚¹54,784/month (99.6% margin)

**Phase 3: Full Scale (38 Districts, 57,000 Subscribers)**

Per District Average:
  - 1,500 subscribers
  - 2-3 ads = â‚¹8,000/district/month

Total Revenue: â‚¹8,000 Ã— 38 = â‚¹3,04,000/month
Infrastructure Cost: â‚¹605/month (10 IPs auto-scaled)
Net Profit: â‚¹3,03,395/month (99.8% margin)

Annual Revenue: â‚¹36,48,000
Annual Profit: â‚¹36,40,740

---

## 8. Complete Scaling Timeline with Real Numbers

### 8.1 Month-by-Month Projection (Realistic Warmup Adjusted)

\begin{table}[h]
\centering
\small
\begin{tabular}{|l|l|l|l|l|l|l|l|l|}
\hline
\textbf{Month} & \textbf{Districts} & \textbf{Subs} & \textbf{Sends} & \textbf{IPs} & \textbf{Cost} & \textbf{Revenue} & \textbf{Profit} & \textbf{Time} \\
\hline
1 & 1â€“2 & 300 & 300 & 1 & â‚¹135 & â‚¹8,000 & â‚¹7,865 & 2 hrs/wk \\
2 & 3 & 800 & 800 & 1 & â‚¹135 & â‚¹16,000 & â‚¹15,865 & 1.5 hrs/wk \\
3 & 5 & 1,500 & 1,500 & 1 & â‚¹135 & â‚¹27,000 & â‚¹26,865 & 1 hr/wk \\
4 & 5 & 2,200 & 2,200 & 2 & â‚¹189 & â‚¹35,000 & â‚¹34,811 & 1 hr/wk \\
6 & 8 & 6,000 & 6,000 & 3 & â‚¹243 & â‚¹80,000 & â‚¹79,757 & 1.5 hrs/wk \\
9 & 12 & 12,000 & 12,000 & 6 & â‚¹405 & â‚¹1,50,000 & â‚¹1,49,595 & 1.5 hrs/wk \\
12 & 18 & 22,000 & 22,000 & 11 & â‚¹675 & â‚¹2,50,000 & â‚¹2,49,325 & 2 hrs/wk \\
24 & 38 & 55,000 & 55,000 & 28 & â‚¹1,593 & â‚¹4,50,000 & â‚¹4,48,407 & 2 hrs/wk \\
\hline
\end{tabular}
\caption{Realistic growth with gradual warmup (\$0.60/IP pricing)}
\end{table}

**Key changes from v19.0:**

\begin{itemize}
\item \textbf{Month 1:} Start with 1â€“2 districts only (not all 5) for proper IP warmup
\item \textbf{Month 2â€“3:} Gradually add remaining MVP districts as IP1 warms up
\item \textbf{Month 4:} IP2 purchase triggered, but starts low volume and ramps
\item \textbf{Costs updated:} Reflects \$0.60/IP actual pricing (vs â‚¬0.50 assumption)
\end{itemize}

---

## 9. Implementation Checklist

### Phase 0: Pre-Launch Validation (Week 0) - MANDATORY FIRST STEPS

**IP Reputation Check (DO THIS BEFORE ANYTHING ELSE):**

\begin{itemize}
\item[$\square$] \textbf{ğŸš¨ BLOCKER 1: Check if IP is blacklisted}
\item[$\square$] Visit https://mxtoolbox.com/blacklists.aspx
\item[$\square$] Enter IP: 95.217.13.142
\item[$\square$] Check all 100+ blacklists (takes 30 seconds)
\item[$\square$] If blacklisted: Request delisting BEFORE proceeding (24â€“48 hrs)
\item[$\square$] For Spamhaus: https://check.spamhaus.org/
\item[$\square$] For Microsoft: https://sender.office.com/
\item[$\square$] Document results in project log
\end{itemize}

**Only proceed to Phase 1 if IP is clean or delisting confirmed.**

### Phase 1: Foundation (Week 1) - One-Time Setup

**Domain & Accounts:**

\begin{itemize}
\item[$\square$] Purchase domain: nammaoorunews.com
\item[$\square$] Create Hetzner Cloud account
\item[$\square$] Reserve Primary IP: 95.217.13.142 (already done âœ…)
\item[$\square$] \textbf{ğŸš¨ BLOCKER 2: Fix PTR record (Section 6.1) - DO THIS SECOND}
\item[$\square$] In Hetzner Console: Primary IPs â†’ Â·Â·Â· menu â†’ Edit Reverse DNS
\item[$\square$] Set PTR: 95.217.13.142 â†’ mail.nammaoorunews.com
\item[$\square$] Wait 5 minutes for DNS propagation
\item[$\square$] Verify: dig -x 95.217.13.142 +short returns mail.nammaoorunews.com.
\item[$\square$] Screenshot Hetzner console showing correct PTR (for documentation)
\item[$\square$] Create Cloudflare account, add domain
\end{itemize}

**DNS Configuration:**

\begin{itemize}
\item[$\square$] Configure initial DNS records (SPF with 1 IP)
\item[$\square$] Generate initial DKIM keypair
\item[$\square$] Verify PTR record propagation (wait 5 minutes after Hetzner change)
\item[$\square$] Configure DMARC (p=none for monitoring)
\item[$\square$] Set up Cloudflare Email Routing
\end{itemize}

**Pre-Generate All DKIM Keys (Critical for automation):**

# Run once - generates keys for 10 IPs upfront
for i in {1..10}; do
    opendkim-genkey -s mail$i -d nammaoorunews.com
    # Store mail$i.private in n8n variable: DKIM_PRIVATE_IP$i
    # Store mail$i.txt (public key) in n8n variable: DKIM_PUBLIC_IP$i
done

### Phase 2: Core Pipeline (Week 2)

**Cloudflare D1 Setup (Click Tracking Foundation):**

\begin{itemize}
\item[$\square$] Create D1 database: wrangler d1 create namma-clicks
\item[$\square$] Run schema creation (click\_links + click\_events tables)
\item[$\square$] Deploy click-tracker-worker to click.nammaoorunews.com
\item[$\square$] Test worker: curl https://click.nammaoorunews.com/l/test-token
\item[$\square$] Verify 24/7 availability (works when VM is offline)
\end{itemize}

**Infrastructure Setup:**

\begin{itemize}
\item[$\square$] Build Scrapling microservice (Docker image)
\item[$\square$] Push to GitHub Container Registry
\item[$\square$] Create cloud-init script (Docker Compose stack)
\item[$\square$] Test manual CX33 spawn
\end{itemize}

### Phase 3: Beta Launch (Week 5-6)

**Pre-Launch Testing:**

\begin{itemize}
\item[$\square$] \textbf{ğŸš¨ FINAL PTR VERIFICATION (MANDATORY):}
\item[$\square$] Run: dig -x 95.217.13.142 +short
\item[$\square$] Confirm output: mail.nammaoorunews.com. (not clients.your-server.de)
\item[$\square$] If wrong, STOP and fix PTR before proceeding
\item[$\square$] \textbf{Re-verify blacklist status} (check again in case IP changed)
\item[$\square$] Send 1 test email to personal Gmail account
\item[$\square$] Verify it lands in inbox (not spam/rejected)
\item[$\square$] Check email headers for authentication (SPF, DKIM pass)
\item[$\square$] Set up Google Postmaster Tools for domain (track reputation)
\item[$\square$] Set up Microsoft SNDS (if planning Outlook delivery)
\item[$\square$] Test full daily cycle (spawn â†’ pipeline â†’ send â†’ backup â†’ delete)
\end{itemize}

**Gradual Warmup Launch (Critical):**

\begin{itemize}
\item[$\square$] \textbf{Day 1:} Send to 50â€“100 beta subscribers ONLY (1 district)
\item[$\square$] \textbf{Days 2â€“3:} Increase to 150â€“200 subscribers
\item[$\square$] \textbf{Days 4â€“7:} Reach 400â€“600 subscribers (still 1 district)
\item[$\square$] \textbf{Week 2:} Add 2nd district, reach 800â€“1,000 total sends/day
\item[$\square$] \textbf{Week 3:} Add 3rd district if metrics healthy (open rate >30\%, bounce <2\%)
\item[$\square$] \textbf{Week 4:} Reach full 5 MVP districts at 1,500â€“2,000 sends/day
\item[$\square$] Monitor Google Postmaster Tools daily for reputation score
\item[$\square$] If reputation drops to "Low" or "Bad": Pause growth, investigate
\end{itemize}

---

## 10. Success Metrics (KPIs)

### Technical Metrics (100% Automated Monitoring)

\begin{itemize}
\item \textbf{Uptime:} 99.5\%+ (pipeline completes successfully)
\item \textbf{Delivery Rate:} >98\% (bounces <2\%)
\item \textbf{Inbox Placement Rate:} >95\% (not spam folder)
\item \textbf{Processing Time:} <2 hours per day (05:05-07:00 AM)
\item \textbf{Backup Success:} 100\% (daily R2 uploads verified)
\item \textbf{Auto-Scaling Accuracy:} 100\% (triggers at correct thresholds)
\item \textbf{PTR Record Accuracy:} 100\% (all IPs have correct reverse DNS before first use)
\item \textbf{DNS Propagation Time:} <5 minutes (PTR changes take effect)
\item \textbf{Click Tracking Uptime:} 100\% (Cloudflare Worker 24/7 availability)
\item \textbf{Click Capture Rate:} 100\% (all clicks logged, including afternoon/evening)
\item \textbf{D1 Sync Success:} 100\% (daily PostgreSQL sync completes)
\item \textbf{Blacklist Status:} 0 listings (check weekly via MXToolbox)
\item \textbf{Google Postmaster Reputation:} "Medium" or "High" (never "Low" or "Bad")
\item \textbf{IP Warmup Compliance:} Daily volume increases â‰¤20\% per step during warmup
\end{itemize}

### Engagement Metrics

\begin{itemize}
\item \textbf{Open Rate:} >35\% (hyperlocal content advantage)
\item \textbf{Click Rate:} >20\% (CTR on article links)
\item \textbf{Unsubscribe Rate:} <1\% per month
\item \textbf{Spam Complaint Rate:} <0.1\%
\end{itemize}

### Revenue Metrics

\begin{itemize}
\item \textbf{ARPU:} â‚¹10â€“â‚¹20/month per subscriber
\item \textbf{Ad Fill Rate:} 100\% (all ad slots sold)
\item \textbf{Customer LTV:} â‚¹1,500â€“â‚¹2,000 (12-month advertiser retention)
\item \textbf{CAC:} â‚¹0 (organic growth)
\end{itemize}

---

## 11. Competitive Advantages

\begin{enumerate}
\item \textbf{Hyperlocal Precision:} No other newsletter offers district-level targeting in Tamil Nadu
\item \textbf{Advertiser ROI:} 20\% average CTR (vs 2\% industry average)
\item \textbf{Cost Structure:} 99\%+ margins enable aggressive pricing while remaining profitable
\item \textbf{Zero Lock-In:} Open-source stack means you can migrate to any provider anytime
\item \textbf{AI-Powered Curation:} Daily fresh content with zero manual editing
\item \textbf{100\% Automation:} Passive income machine â€” infrastructure scales itself
\end{enumerate}

---

## Conclusion

This PRD defines a **production-ready, revenue-generating, fully automated newsletter infrastructure** that:

\begin{enumerate}
\item \textbf{Starts at â‚¹126/month} and scales automatically to â‚¹605/month for 38 districts
\item \textbf{Generates â‚¹30,000â€“â‚¹50,000/month} revenue at MVP scale (5 districts, 2,500 subscribers)
\item \textbf{Scales to â‚¹3,00,000+/month} at full Tamil Nadu coverage (38 districts, 57,000+ subscribers)
\item \textbf{Achieves 99\%+ profit margins} through hyperlocal ad targeting
\item \textbf{Requires ~5 minutes/day} for monitoring + ~30 minutes/month for advertiser onboarding
\item \textbf{Auto-scales infrastructure} â€” buys IPs, updates DNS, rebalances load with zero manual intervention
\end{enumerate}

**Critical Pre-Launch Actions (In Order):**

**ğŸš¨ ACTION 1 (DO NOW):** Fix PTR Record

\begin{enumerate}
\item Hetzner Console â†’ Primary IPs â†’ Â·Â·Â· menu â†’ Edit Reverse DNS[7]
\item Set: 95.217.13.142 â†’ mail.nammaoorunews.com
\item Wait 5 minutes, verify: dig -x 95.217.13.142 +short
\item Must show mail.nammaoorunews.com. (not clients.your-server.de)
\end{enumerate}

**This 30-second fix prevents 100% spam delivery. Without it, you cannot launch.**

**ACTION 2:** Follow Implementation Checklist (Section 9) for remaining setup

**The Key Innovation:** While competitors require DevOps teams to scale infrastructure, your system **scales itself automatically**. The PTR fix is the ONLY manual configuration required - everything else is automated.

**Next Step:** Fix PTR (Section 6.1), then follow Implementation Checklist to go from PRD â†’ Live Product in 8 weeks.

---

**Document Version:** v20.0 Final  
**Last Updated:** February 24, 2026, 7:50 PM IST  
**Status:** Ready for Implementation âœ… (After Blacklist Check + PTR Fix)

**Critical Changes from v19.0:**

\begin{itemize}
\item \textbf{ADDED:} Mandatory IP blacklist pre-check (Phase 0) â€” must verify before any setup
\item \textbf{ADDED:} Realistic IP warmup schedule (100â†’2,000 over 3â€“4 weeks, not instant 2,000)
\item \textbf{CORRECTED:} IPv4 pricing from â‚¬0.50 to \$0.60/month (â‚¹54, not â‚¹45)
\item \textbf{UPDATED:} All cost tables reflect accurate \$0.60/IP pricing
\item \textbf{UPDATED:} Month-by-month projections adjusted for gradual warmup reality
\item \textbf{ADDED:} Microsoft Outlook blacklist guidance (separate delisting process)
\item \textbf{ENHANCED:} Implementation checklist with 3-tier blockers (blacklist â†’ PTR â†’ warmup)
\item \textbf{CLARIFIED:} You need only 1 IP for launch; IP2 added later when volume justifies
\end{itemize}

**Key Differentiator:** 100% Automated Scaling + Realistic Warmup + Blacklist-Aware Launch

## References

[1] Hetzner Cloud. (2026). Primary IP Configuration. Hetzner Docs. https://docs.hetzner.com/cloud/servers/primary-ips/primary-ip-configuration/

[2] InfraForge. (2026, January 20). How Reverse DNS Impacts Email Deliverability. https://www.infraforge.ai/blog/reverse-dns-email-deliverability-impact

[3] Reddit. (2014, October 23). Note to everyone: Gmail is a lot stricter with email from IPv6 than IPv4 SMTP servers. r/ipv6. https://www.reddit.com/r/ipv6/comments/2k0yib/note_to_everyone_gmail_is_a_lot_stricter_with/

[4] Hetzner. (2025, October 6). PTR record - Hetzner Docs. https://docs.hetzner.com/networking/dns/record-types/ptr-record/

[5] PrimeForge. (2026, January 20). Reverse DNS Best Practices for IP Reputation. https://www.primeforge.ai/blog/reverse-dns-best-practices-for-ip-reputation

[6] PrimeForge. (2026, January 20). Reverse DNS Lookup: Role in Email Deliverability. https://www.primeforge.ai/blog/reverse-dns-lookup-role-in-email-deliverability

[7] Cloudron Forum. (2020, August 13). PTR record hetzner. https://forum.cloudron.io/topic/3025/ptr-record-hetzner

[8] Twilio SendGrid. (2025, June 30). Email Guide to IP Warm Up. https://www.twilio.com/en-us/resource-center/email-guide-ip-warm-up

[9] MailReach. (2026, February 1). Warm Up Your Email Domain the Right Way in 2026. https://www.mailreach.co/blog/how-to-warm-up-email-domain

[10] Warmup Inbox. (2026, January 15). How to warm up an email domain (+ best practices). https://www.warmupinbox.com/blog/email-warmup/domain-warm-up/

[11] Reddit. (2023, November 30). Migrated many clients to new floating IP, found out it is blacklisted. r/hetzner. https://www.reddit.com/r/hetzner/comments/1889acz/migrated_many_clients_to_new_floating_ip_found/

[12] Reddit. (2025, February 4). Bad experience with Hetzner, IPs are blacklisted. r/hetzner. https://www.reddit.com/r/hetzner/comments/1ihaqoe/bad_experience_with_hetzner_ips_are_blacklisted/

[13] MxToolbox. (2026). IP Blacklist Check. https://mxtoolbox.com/blacklists.aspx

[14] Hetzner Docs. (2024, November 8). Microsoft Blacklist. https://docs.hetzner.com/robot/dedicated-server/troubleshooting/microsoft-blacklist/